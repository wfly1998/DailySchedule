# 读书笔记

## UNIX 操作系统设计

*限于时间和篇幅，本笔记只记录重点及未掌握知识，已掌握的基础知识不再记录*

### 第一章 系统概貌

* 命令行中，记号 “2>” 意味着对文件描述符 2 进行输出重定向。按惯例，文件描述符 2 为标准错误文件

### 第二章 内核导言

* 文件系统具有如下结构：引导块、超级块、索引节点表、数据块；每个文件系统都有一个（可能是空的）引导块
* 仅当进程从 “核心态运行” 状态转移到 “在内存中睡眠” 状态时，内核才允许上下文切换

### 第三章 数据缓冲区高速缓冲

这一章没接触过，重点记一下

* 内核通过保持一个称为数据缓冲区高速缓冲(buffer cache)（简称高速缓冲）的内部数据缓冲区池来试图减小对磁盘的存取频率。
  * 其中，数据缓冲区高速缓冲是一个软件结构，请不要与加速主存访问的硬件高速缓冲混淆
* 一个缓冲区的数据与文件系统上一个逻辑磁盘块中的数据相对应，并且内核通过考察缓冲头部中的标识符字段来识别缓冲区内容。
  * 缓冲区是磁盘块(disk block)在主存中的备份，磁盘块的内容映射到缓冲区中
* 缓冲头部包含一个设备号字段与一个块号字段，这两个字段指明了文件系统与磁盘上的数据的块号，并且唯一地标识了该缓冲区
  * 设备号是文件系统号，而不是物理设备（磁盘）号
  * 缓冲头部也包含一个指向该缓冲区的数据数组的指针，该数组大小至少必须有磁盘块那么大
  * 缓冲头部还包含状态字节，它概括了缓冲区的当前状态

* 一个缓冲区状态是如下条件的组合：
  * 缓冲区当前为“上锁”
  * 缓冲区包含有效数据
  * 内核在把某段缓冲区重新分配出去之前必须把该缓冲区内容写到磁盘上，这一条件叫做“延迟写”(delayed write)
  * 内核当前正在从磁盘往缓冲区读信息或把缓冲区的内容写到磁盘上
  * 一个进程当前正在等候缓冲区变为闲


